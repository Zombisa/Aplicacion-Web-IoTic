<app-loading-page *ngIf="loadingService.loading$ | async"></app-loading-page>

<div *ngIf="!(loadingService.loading$ | async)">
  <div class="header-wrapper">
    <app-header></app-header>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col-12 p-0">
        <div class="banner-primary d-flex justify-content-center align-items-center flex-column">
          <h1 class="title">Editar Mi Perfil</h1>
          <p class="text-help">Actualiza tu información personal</p>
        </div>
      </div>
    </div>

    <!-- Mensaje de error -->
    <div *ngIf="showError" class="alert alert-danger mt-4 mx-4" role="alert">
      {{ errorMessage }}
    </div>

    <!-- Mensaje de éxito -->
    <div *ngIf="showSuccess" class="alert alert-success mt-4 mx-4" role="alert">
      {{ successMessage }}
    </div>

    <!-- Contenido principal -->
    <section *ngIf="!showError && user" class="edit-profile-content">
      <div class="container-fluid px-3 px-md-4">
        <div class="row justify-content-center">
          <div class="col-12 col-md-10 col-lg-8">
            <div class="form-edit-profile-container">
              <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="user-form" novalidate>
                <!-- Nombre -->
                <div class="input-container personality-camp mt-2">
                  <input 
                    type="text" 
                    class="input-line" 
                    formControlName="nombre" 
                    placeholder=" "
                    [class.is-invalid]="userForm.get('nombre')?.invalid && userForm.get('nombre')?.touched"
                  >
                  <label>Nombre <span class="text-danger">*</span></label>
                  <div class="invalid-feedback" *ngIf="userForm.get('nombre')?.invalid && userForm.get('nombre')?.touched">
                    <small *ngIf="userForm.get('nombre')?.errors?.['required']">El nombre es obligatorio</small>
                    <small *ngIf="userForm.get('nombre')?.errors?.['minlength']">Debe tener al menos 2 caracteres</small>
                  </div>
                </div>

                <!-- Apellido -->
                <div class="input-container personality-camp mt-2">
                  <input 
                    type="text" 
                    class="input-line" 
                    formControlName="apellido" 
                    placeholder=" "
                    [class.is-invalid]="userForm.get('apellido')?.invalid && userForm.get('apellido')?.touched"
                  >
                  <label>Apellido <span class="text-danger">*</span></label>
                  <div class="invalid-feedback" *ngIf="userForm.get('apellido')?.invalid && userForm.get('apellido')?.touched">
                    <small *ngIf="userForm.get('apellido')?.errors?.['required']">El apellido es obligatorio</small>
                    <small *ngIf="userForm.get('apellido')?.errors?.['minlength']">Debe tener al menos 2 caracteres</small>
                  </div>
                </div>

                <!-- Email -->
                <div class="input-container personality-camp mt-2">
                  <input 
                    type="email" 
                    class="input-line" 
                    formControlName="email" 
                    placeholder=" "
                    [class.is-invalid]="userForm.get('email')?.invalid && userForm.get('email')?.touched"
                  >
                  <label>Email <span class="text-danger">*</span></label>
                  <div class="invalid-feedback" *ngIf="userForm.get('email')?.invalid && userForm.get('email')?.touched">
                    <small *ngIf="userForm.get('email')?.errors?.['required']">El email es obligatorio</small>
                    <small *ngIf="userForm.get('email')?.errors?.['email']">Debe ser un email válido</small>
                  </div>
                </div>

                <!-- Botones -->
                <div class="d-flex flex-column flex-sm-row gap-2 gap-sm-3 justify-content-end mt-4">
                  <button type="button" class="btn btn-outline-secondary px-3 px-md-4 order-2 order-sm-1" (click)="onCancel()">
                    Cancelar
                  </button>
                  <button type="button" class="btn btn-outline-secondary px-3 px-md-4 order-3 order-sm-2" (click)="resetForm()">
                    Limpiar
                  </button>
                  <button type="submit" class="btn btn-primary px-3 px-md-4 order-1 order-sm-3" [disabled]="userForm.invalid">
                    Guardar Cambios
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
