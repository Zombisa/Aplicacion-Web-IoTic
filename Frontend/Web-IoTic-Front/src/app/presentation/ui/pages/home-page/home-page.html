<div class="app-container">
  <div class="header-wrapper">
    <app-header></app-header>
  </div>
  <div class="container-fluid d-flex align-items-center py-5 banner-primary mb-2">
    <div class="row d-flex justify-content-center align-items-center">
      <div class="col-md-6 d-flex" id="title-banner-home">
        <h1 class="text-white animate-on-scroll animate-fadeInUp" id="title-home">
          Conoce el Semillero de IoTic
        </h1>
      </div>
      <div class="col-md-6 text-center">
        <img src="" alt="" />
      </div>
    </div>
  </div>

  <section class="container-fluid d-flex flex-column align-items-center px-3 sectionWelcome">
    <div
      id="welcomeCarousel"
      class="carousel slide"
      data-bs-ride="carousel"
      data-bs-interval="4000"
    >
      <!-- Indicadores del carrusel -->
      <div class="carousel-indicators">
        <button
          *ngFor="let mensaje of mensajes; let i = index"
          type="button"
          data-bs-target="#welcomeCarousel"
          [attr.data-bs-slide-to]="i"
          [class.active]="i === 0"
          [attr.aria-label]="'Slide ' + (i + 1)"
        ></button>
      </div>

      <div class="carousel-inner text-center d-flex align-items-center">
        <div
          *ngFor="let mensaje of mensajes; let i = index"
          class="carousel-item"
          [class.active]="i === 0"
        >
          <p class="textWelcome">{{ mensaje }}</p>
        </div>
      </div>
    </div>
  </section>

  <section class="py-5 registro-fotografico">
    <div class="container">
      <div class="row text-center mb-4">
        <div class="col-12 d-flex flex-column align-items-center">
          <h2 class="display-6 mb-3">Registro Fotográfico</h2>
          <p class="lead text-muted fw-bold">
            Momentos destacados de nuestro grupo de investigación, momentos que siempre quedan
            guardados en nuestra memoria.
          </p>
          <div class="registro-divider mb-4"></div>

          <!-- Carrusel de fotos -->
          <div
            id="registroFotograficoCarousel"
            class="carousel slide registro-carousel"
            *ngIf="registrosFotograficosSlides.length > 0"
          >
            <!-- Slides -->
            <div class="carousel-inner">
              <div
                *ngFor="let slide of registrosFotograficosSlides; let i = index"
                class="carousel-item"
                [class.active]="i === 0"
              >
                <div
                  class="d-flex justify-content-center align-items-center gap-4 registro-slide-row"
                >
                  <div *ngFor="let reg of slide" class="registro-item">
                    <img
                      [src]="reg.foto_r2"
                      [alt]="reg.titulo || 'Registro fotográfico'"
                      class="registro-image"
                    />
                  </div>
                </div>
              </div>
            </div>

            <!-- Controles -->
            <button
              class="carousel-control-prev registro-control"
              type="button"
              data-bs-target="#registroFotograficoCarousel"
              data-bs-slide="prev"
            >
              <span class="registro-arrow">&#x2190;</span>
              <span class="visually-hidden">Anterior</span>
            </button>
            <button
              class="carousel-control-next registro-control"
              type="button"
              data-bs-target="#registroFotograficoCarousel"
              data-bs-slide="next"
            >
              <span class="registro-arrow">&#x2192;</span>
              <span class="visually-hidden">Siguiente</span>
            </button>
          </div>

          <!-- Texto mostrado si aún no hay fotos -->
          <div *ngIf="registrosFotograficosSlides.length === 0" class="text-muted small">
            Aún no hay registros fotográficos publicados.
          </div>

          <button class="btn btn-outline-primary mt-3" (click)="goToRegistroFotografico()">
            Ver galería completa
          </button>
        </div>
      </div>
    </div>
  </section>

  <!-- Sección de Últimas Publicaciones -->
  <app-loading-page *ngIf="loadingService.loading$ | async"></app-loading-page>
  <section
    *ngIf="!(loadingService.loading$ | async)"
    class="container-fluid py-5 latest-publications-section"
  >
    <div class="container">
      <div class="row">
        <div *ngFor="let item of getAvailablePublications()" class="col-12 col-md-6 mb-4">
          <div class="publication-card d-flex align-items-center p-4 bg-white shadow-sm rounded">
            <!-- Imagen/Placeholder -->
            <div class="publication-image me-4">
              <div class="image-placeholder d-flex align-items-center justify-content-center">
                <img
                  *ngIf="item.publication.image_r2"
                  [src]="item.publication.image_r2"
                  [alt]="item.publication.titulo"
                  class="img-fluid rounded"
                />
                <div *ngIf="!item.publication.image_r2" class="placeholder-icon">
                  <svg
                    width="60"
                    height="60"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                    <circle cx="8.5" cy="8.5" r="1.5"></circle>
                    <polyline points="21 15 16 10 5 21"></polyline>
                  </svg>
                </div>
              </div>
            </div>

            <!-- Información de la publicación -->
            <div class="publication-info flex-grow-1">
              <h5 class="publication-title mb-2 fw-bold">Última publicación:</h5>
              <p class="publication-type mb-1 text-muted small">{{ item.label }}</p>
              <p class="publication-name mb-1 fw-semibold">{{ item.publication.titulo }}</p>
              <p class="publication-year mb-2 text-muted small" *ngIf="item.publication.anio">
                Año: {{ item.publication.anio }}
              </p>
              <button
                class="btn btn-sm btn-outline-primary mt-2"
                (click)="navigateToPublication(item.publication.tipo, item.publication.id)"
              >
                Ver más
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
