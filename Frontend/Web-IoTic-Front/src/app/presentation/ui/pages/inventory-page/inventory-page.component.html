<div class="inventory-container">
  <h2 class="title">
    <span class="cube">üì¶</span>
    Inventario de Dispositivos
  </h2>

  <!-- Filtros -->
  <div class="filters">
    <input [(ngModel)]="filtro.nombre" placeholder="Buscar por nombre o referencia" />
    <select [(ngModel)]="filtro.categoria">
      <option value="">Todas las categor√≠as</option>
      <option *ngFor="let c of categorias" [value]="c">{{ c }}</option>
    </select>
    <select [(ngModel)]="filtro.estado">
      <option value="">Todos los estados</option>
      <option *ngFor="let e of estados" [value]="e">{{ e }}</option>
    </select>
    <button class="btn-primary" (click)="abrirModal()">‚ûï Agregar</button>
  </div>

  <!-- Tabla -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Ref.</th>
          <th>Nombre</th>
          <th>Categor√≠a</th>
          <th>Tipo</th>
          <th>Unidad</th>
          <th class="num">Cant.</th>
          <th class="num">V. Unit.</th>
          <th class="num">V. Total</th>
          <th>Estado</th>
          <th>Ubicaci√≥n</th>
          <th class="acciones">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let d of devices | filterInventory:filtro">
          <td>{{ d.referencia }}</td>
          <td>
            <div class="nombre">
              <div class="n">{{ d.nombre }}</div>
              <small class="desc">{{ d.descripcion }}</small>
            </div>
          </td>
          <td>{{ d.categoria }}</td>
          <td>{{ d.tipo === 'CONSUMIBLE' ? 'Consumible' : 'No consumible' }}</td>
          <td>{{ d.unidad }}</td>
          <td class="num">{{ d.cantidad }}</td>
          <td class="num">{{ d.valorUnitario | currency:'COP':'symbol' }}</td>
          <td class="num">{{ d.valorTotal | currency:'COP':'symbol' }}</td>
          <td>
            <span class="estado" [ngClass]="{
              nuevo: d.estado === 'Nuevo',
              operativo: d.estado === 'Operativo',
              mantenimiento: d.estado === 'En mantenimiento',
              baja: d.estado === 'Dado de baja'
            }">{{ d.estado }}</span>
          </td>
          <td>{{ d.ubicacion }}</td>
          <td class="acciones">
            <button title="Editar" (click)="editar(d)">‚úèÔ∏è</button>
            <button title="Dar de baja" (click)="registrarBaja(d)">üìâ</button>
            <button title="Eliminar" class="danger" (click)="eliminar(d.id)">üóëÔ∏è</button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!--  Modal Agregar/Editar -->
<dialog #modal>
  <form method="dialog" class="modal">
    <h3>{{ editando ? 'Editar' : 'Agregar' }} √≠tem</h3>

    <div class="grid">
      <label>
        <span>Referencia</span>
        <input [(ngModel)]="form.referencia" name="referencia" required />
      </label>

      <label>
        <span>Nombre</span>
        <input [(ngModel)]="form.nombre" name="nombre" required />
      </label>

      <label class="col-2">
        <span>Descripci√≥n</span>
        <input [(ngModel)]="form.descripcion" name="descripcion" />
      </label>

      <label>
        <span>Categor√≠a</span>
        <input [(ngModel)]="form.categoria" name="categoria" list="catList" />
        <datalist id="catList">
          <option *ngFor="let c of categorias" [value]="c"></option>
        </datalist>
      </label>

      <label>
        <span>Tipo</span>
        <select [(ngModel)]="form.tipo" name="tipo">
          <option value="CONSUMIBLE">Consumible</option>
          <option value="NO_CONSUMIBLE">No consumible</option>
        </select>
      </label>

      <label>
        <span>Unidad</span>
        <input [(ngModel)]="form.unidad" name="unidad" />
      </label>

      <label>
        <span>Cantidad</span>
        <input type="number" [(ngModel)]="form.cantidad" name="cantidad" min="0" />
      </label>

      <label>
        <span>Valor unitario</span>
        <input type="number" [(ngModel)]="form.valorUnitario" name="valorUnitario" min="0" />
      </label>

      <label>
        <span>Estado</span>
        <select [(ngModel)]="form.estado" name="estado">
          <option *ngFor="let e of estados" [value]="e">{{ e }}</option>
        </select>
      </label>

      <label>
        <span>Ubicaci√≥n</span>
        <input [(ngModel)]="form.ubicacion" name="ubicacion" />
      </label>

      <label>
        <span>Fecha adquisici√≥n</span>
        <input type="date" [(ngModel)]="form.fechaAdquisicion" name="fechaAdquisicion" />
      </label>

      <label class="col-2">
        <span>Doc. soporte (opcional)</span>
        <input [(ngModel)]="form.documentoSoporte" name="documentoSoporte" placeholder="OC-2025-0001 / URL" />
      </label>
    </div>

    <div class="modal-actions">
      <button type="button" (click)="guardar()" class="btn-primary">Guardar</button>
      <button type="button" (click)="cerrarModal()">Cancelar</button>
    </div>
  </form>
</dialog>
