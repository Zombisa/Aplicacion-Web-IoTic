<div class="inventory-container">
  <h2 class="title">
    <span class="cube">ğŸ“¦</span>
    Inventario de Dispositivos
  </h2>

  <!--  Resumen -->
  <div class="summary">
    <div class="card">
      <h4>Total Ãtems</h4>
      <p>{{ totalItems }}</p>
    </div>
    <div class="card available">
      <h4>Disponibles</h4>
      <p>{{ totalDisponibles }}</p>
    </div>
    <div class="card borrowed">
      <h4>Prestados</h4>
      <p>{{ totalPrestados }}</p>
    </div>
    <div class="card low">
      <h4>Dado de baja</h4>
      <p>{{ totalBaja }}</p>
    </div>
  </div>

  <!-- Filtros -->
  <div class="filters">
    <input [(ngModel)]="filtro.nombre" placeholder="Buscar por nombre o referencia" />
    
    <select [(ngModel)]="filtro.estado">
      <option value="">Todos los estados</option>
      @for (e of estados; track e) { <option [value]="e">{{ e }}</option>}
    </select>
    <button class="btn-primary" (click)="abrirModal()">â• Agregar</button>
  </div>

  <!-- Tabla -->
  <div class="table-wrap">
    <table>
      <thead>
        <tr>
          <th>Ref.</th>
          <th>Nombre</th>
          <th>Tipo</th>
          <th class="num">Cant.</th>
          <th>Estado</th>
          <th class="acciones">Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (d of devices | filterInventory : filtro; track d.referencia) {
          <tr>
            <td>{{ d.referencia }}</td>
            <td>
              <div class="nombre">
                <div class="n">{{ d.nombre }}</div>
              </div>
            </td>
            <td>{{ d.tipo === 'CONSUMIBLE' ? 'Consumible' : 'No consumible' }}</td>
            <td class="num">{{ d.cantidad }}</td>
            <td>
              <span
                class="estado"
                [ngClass]="{
                  prestado: d.estado === 'Prestado',
                  disponible: d.estado === 'Disponible',
                  baja: d.estado === 'Dado de baja'
                }"
              >
                {{ d.estado }}
              </span>
            </td>
            <td class="acciones">
              <button title="Editar" (click)="editar(d)">âœï¸</button>
              <button title="PrÃ©stamo" (click)="registrarPrestamo(d)">ğŸ“¤</button>
              <button title="DevoluciÃ³n" (click)="registrarDevolucion(d)">ğŸ“¥</button>
              <button title="Dar de baja" (click)="registrarBaja(d)">ğŸ“‰</button>
              <button title="Eliminar" class="danger" (click)="eliminar(d.id)">ğŸ—‘ï¸</button>
            </td>
          </tr>
        }
      </tbody>
    </table>
  </div>
</div>

<!--  Modal Agregar/Editar -->
<dialog #modal>
  <form method="dialog" class="modal">
    <h3>{{ editando ? 'Editar' : 'Agregar' }} Ã­tem</h3>

    <div class="grid">
      <label>
        <span>Referencia</span>
        <input [(ngModel)]="form.referencia" name="referencia" required />
      </label>

      <label>
        <span>Nombre</span>
        <input [(ngModel)]="form.nombre" name="nombre" required />
      </label>

      <label>
        <span>Tipo</span>
        <select [(ngModel)]="form.tipo" name="tipo">
          <option value="CONSUMIBLE">Consumible</option>
          <option value="NO_CONSUMIBLE">No consumible</option>
        </select>
      </label>

      <label>
        <span>Cantidad</span>
        <input type="number" [(ngModel)]="form.cantidad" name="cantidad" min="0" />
      </label>

      <label>
        <span>Estado</span>
        <select [(ngModel)]="form.estado" name="estado">
          <option *ngFor="let e of estados" [value]="e">{{ e }}</option>
        </select>
      </label>

      <label>
        <span>Fecha adquisiciÃ³n</span>
        <input type="date" [(ngModel)]="form.fechaAdquisicion" name="fechaAdquisicion" />
      </label>
    </div>

    <div class="modal-actions">
      <button type="button" (click)="guardar()" class="btn-primary">Guardar</button>
      <button type="button" (click)="cerrarModal()">Cancelar</button>
    </div>
  </form>
</dialog>
