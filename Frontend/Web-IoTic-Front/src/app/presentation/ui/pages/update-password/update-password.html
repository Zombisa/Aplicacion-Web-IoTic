<app-loading-page *ngIf="loadingService.loading$ | async"></app-loading-page>

<div *ngIf="!(loadingService.loading$ | async)">
  <div class="header-wrapper">
    <app-header></app-header>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col-12 p-0">
        <div class="banner-primary d-flex justify-content-center align-items-center flex-column">
          <h1 class="title">Actualizar Contraseña</h1>
          <p class="text-help">Cambia tu contraseña de forma segura</p>
        </div>
      </div>
    </div>

    <!-- Mensaje de error -->
    <div *ngIf="showError" class="alert alert-danger mt-4 mx-4" role="alert">
      {{ errorMessage }}
    </div>

    <!-- Mensaje de éxito -->
    <div *ngIf="showSuccess" class="alert alert-success mt-4 mx-4" role="alert">
      {{ successMessage }}
    </div>

    <!-- Contenido principal -->
    <section class="update-password-content">
      <div class="container-fluid px-3 px-md-4">
        <div class="row justify-content-center">
          <div class="col-12 col-md-10 col-lg-8">
            <div class="form-update-password-container">
              <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="password-form" novalidate>
                <!-- Contraseña actual -->
                <div class="input-container personality-camp mt-2">
                  <input 
                    type="password" 
                    class="input-line" 
                    formControlName="currentPassword" 
                    placeholder=" "
                    [class.is-invalid]="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched"
                  >
                  <label>Contraseña Actual <span class="text-danger">*</span></label>
                  <div class="invalid-feedback" *ngIf="passwordForm.get('currentPassword')?.invalid && passwordForm.get('currentPassword')?.touched">
                    <small *ngIf="passwordForm.get('currentPassword')?.errors?.['required']">La contraseña actual es obligatoria</small>
                  </div>
                </div>

                <!-- Nueva contraseña -->
                <div class="input-container personality-camp mt-2">
                  <input 
                    type="password" 
                    class="input-line" 
                    formControlName="newPassword" 
                    placeholder=" "
                    [class.is-invalid]="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched"
                  >
                  <label>Nueva Contraseña <span class="text-danger">*</span></label>
                  <div class="invalid-feedback" *ngIf="passwordForm.get('newPassword')?.invalid && passwordForm.get('newPassword')?.touched">
                    <small *ngIf="passwordForm.get('newPassword')?.errors?.['required']">La nueva contraseña es obligatoria</small>
                    <small *ngIf="passwordForm.get('newPassword')?.errors?.['minlength']">Debe tener al menos 6 caracteres</small>
                  </div>
                </div>

                <!-- Confirmar contraseña -->
                <div class="input-container personality-camp mt-2">
                  <input 
                    type="password" 
                    class="input-line" 
                    formControlName="confirmPassword" 
                    placeholder=" "
                    [class.is-invalid]="(passwordForm.get('confirmPassword')?.invalid || passwordForm.errors?.['passwordMismatch']) && passwordForm.get('confirmPassword')?.touched"
                  >
                  <label>Confirmar Nueva Contraseña <span class="text-danger">*</span></label>
                  <div class="invalid-feedback" *ngIf="(passwordForm.get('confirmPassword')?.invalid || passwordForm.errors?.['passwordMismatch']) && passwordForm.get('confirmPassword')?.touched">
                    <small *ngIf="passwordForm.get('confirmPassword')?.errors?.['required']">Debes confirmar la nueva contraseña</small>
                    <small *ngIf="passwordForm.errors?.['passwordMismatch']">Las contraseñas no coinciden</small>
                  </div>
                </div>

                <!-- Botones -->
                <div class="d-flex flex-column flex-sm-row gap-2 gap-sm-3 justify-content-end mt-4">
                  <button type="button" class="btn btn-outline-secondary px-3 px-md-4 order-2 order-sm-1" (click)="onCancel()">
                    Cancelar
                  </button>
                  <button type="button" class="btn btn-outline-secondary px-3 px-md-4 order-3 order-sm-2" (click)="resetForm()">
                    Limpiar
                  </button>
                  <button type="submit" class="btn btn-primary px-3 px-md-4 order-1 order-sm-3" [disabled]="passwordForm.invalid">
                    Actualizar Contraseña
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>
